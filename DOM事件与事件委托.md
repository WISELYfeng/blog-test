# DOM事件与事件委托

2021.3.12

## 一、DOM事件

### 事件简介

根据[MDN的文档](https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Building_blocks/Events)给出的定义，可以说事件是指某件事发生后产生的信号，系统会接收这个信号并且给出回应动作。

比如在网页上，当用户点击了某个按钮，点击行为就是一种事件，而浏览器要对点击事件作出响应。

每个可用的事件都会有一个事件处理器，也就是事件触发时会运行的代码块。当定义了一个用来回应事件被激发的代码块的时候，就是注册了一个事件处理器。事件处理器有时候被叫做事件监听器,它同时负责监听与处理。监听器留意事件是否发生，然后处理器对事件做出回应。

> 事件处理并不是JS的内置功能，而是JS调用浏览器API处理事件。

### 常用事件

浏览器中常用的事件有鼠标点击、悬浮事件，滚动条滚动事件，视频播放事件等，有上百种事件，具体列表参见[MDN事件参考](https://developer.mozilla.org/zh-CN/docs/Web/Events)。

### 事件实例

``` HTML
    <button>Change color</button>
```

``` javascript
    const btn = document.querySelector('button');

    function random(number) {
        return Math.floor(Math.random()*(number+1));
    }

    btn.onclick = function() {
        const rndCol = 'rgb(' + random(255) + ',' + random(255) + ',' + random(255) + ')';
        document.body.style.backgroundColor = rndCol;
    }
```

上面的代码执行的效果是当点击按钮后，按钮的背景色将随机变化。

首先，使用`btn`变量获取按钮元素，接着定义一个生成随机数的函数，再对该元素绑定一个点击事件的处理器，该处理器以匿名函数的方式调用`random`生成随机颜色，并将按钮的背景色替换为生成的随机颜色。

只要`<button>`被点击，该段代码就会被执行。

### 冒泡与捕获

冒泡：当一个事件发生在一个元素上，浏览器会首先运行在该元素上的处理程序，然后运行其亲元素上的处理程序，然后一直向上到其他祖先上的处理程序。冒泡会从事件发生的元素开始到最顶层的document上。

阻止冒泡：在不需要冒泡的情况下，可以阻止元素的冒泡，使用`event.stopPropagation()`。

捕获：当事件发生时，由Window开始向下运行处理程序，直到发生事件的元素执行处理器。在实际开发中很少用。

> 在网页中，浏览器会先执行捕获流程，从外到内执行处理器，再执行冒泡流程，从内到外执行处理器。处理器的执行顺序可以在绑定处理器时指定是在捕获阶段还是冒泡阶段。

## 二、事件委托

### 简介

基于事件的捕获与冒泡可以实现被称为**事件委托**的事件处理模式。

当存在大量子元素时，如果要对每个元素的事件作出响应，让每个元素都绑定处理器并不是高效的方式，应该将事件处理器绑定到子元素的亲节点上，并让子元素发生的事件冒泡到亲节点，这样就不需要一个个子元素单独绑定处理器。

### 事件对象

当在祖先元素上使用事件委托时，如何区分事件在哪个后代元素上发生？由于使用处理器时，**事件对象**会作为处理程序的参数传入，因此可以通过**事件对象**上的属性分辨发生事件的具体元素。

``` javascript
    div.addEventListener('click',(e) => {
        console.log(e.target)  // 输出发生点击事件的元素
    })
```

使用上面代码的方式绑定处理器，相当于监听`<div>`内所有后代元素发生的点击事件。`e`就是传入的事件对象，`e.target`表示发生事件的元素。

使用事件委托可以节省内存，减少代码量。
